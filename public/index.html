<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<h1> MOST BASIC YOUTUBE MP3 DOWNLOADER EVER</h1>
<form action="/" method="post">
    <input type="string" name="url" placeholder="video url here!">
    <input type="submit" value="submit">
</form>

    <label for="">Search Music</label>
    <input id="search" type="string" name="filter" placeholder="Find music">
    <button onclick="searchMusic()">search</button>


<button onclick="getAudio()" >Get Audio</button>

<ul id="musicList"></ul>
<div id="waveform"></div>
<script src="https://unpkg.com/wavesurfer.js"></script>
<script>
    var wavesurfer = WaveSurfer.create({
        container: '#waveform'
    });
    const getAudio = () => {
        const data = fetch('http://localhost:3000/data')
        .then(async (data) => {
            const audio = await data.json()
            const file = audio.audioFile
            console.log(file);
            let base64String = arrayBufferToBase64( file.data )
            const snd = new Audio("data:audio/wav;base64," + base64String);
            wavesurfer.load(snd)
        })
    }
    wavesurfer.on('ready',() => wavesurfer.play())


    function arrayBufferToBase64( buffer ) {
	    var binary = '';
	    var bytes = new Uint8Array( buffer );
	    var len = bytes.byteLength;
	    for (var i = 0; i < len; i++) {
		    binary += String.fromCharCode( bytes[ i ] );
	    }
	    return window.btoa( binary );
    }

async function searchMusic() {
    const response = await postData()
    console.log(response);
    response.forEach((item) => {
        let li = document.createElement('li')
        li.textContent = item.title
        document.getElementById('musicList').appendChild(li)
    })
}
    // Example POST method implementation:
async function postData() {
  // Default options are marked with *
  const response = await fetch('http://localhost:3000/music/find', {
    method: 'POST', // *GET, POST, PUT, DELETE, etc.
    mode: 'cors', // no-cors, *cors, same-origin
    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
    credentials: 'same-origin', // include, *same-origin, omit
    headers: {
      'Content-Type': 'application/json'
      // 'Content-Type': 'application/x-www-form-urlencoded',
    },
    redirect: 'follow', // manual, *follow, error
    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
    body: JSON.stringify({ filter: document.getElementById('search').value }) // body data type must match "Content-Type" header
  });
  return response.json(); // parses JSON response into native JavaScript objects
}

    
</script>
</body>
</html>